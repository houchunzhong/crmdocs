# 💰 佣金与产品分类配置指南

佣金配置是 CRM 系统管理代理商返佣的核心模块。通过对交易产品进行科学分类，管理员可以针对不同的交易环境（服务器+组）实现精细化的返佣管理。

## 1. 产品分类 (Product Type)

所有的交易产品（Symbols）会从 MT5 等交易系统实时同步至 CRM。管理员需要根据返佣标准对这些产品进行分类。

- **分类原则**  
  产品分类的关键在于“返佣一致性”。只有返佣方案完全相同的产品才应归入同一个类型。如果返佣标准不同，必须创建不同的类别进行区分。

- **示例说明**  
  如果 EUR/USD 的返佣是 2 美金，而 GBP/USD 或 USD/JPY 的返佣是 3 美金，则不能将它们放在同一个类型中，而需分别建立类似 Forex.Major 和 Forex.Cross 的分类。

⚙ **核心配置项**  
- **产品分类名称 (Product Type Name)**  
  设置清晰的分类名称，例如：Forex.Standard 或 Metal.Standard。

- **未分类产品 (Uncategorized Products)**  
  展示从交易服务器同步过来但尚未归类的产品列表。点击 Sync Products 可手动触发同步。

- **已选产品 (Selected Items)**  
  将左侧待分配的产品移至右侧，即完成该类别的产品归集。

## 2. 佣金计划 (Commission Plan)

完成产品分类后，管理员需在佣金计划中，结合“交易服务器”、“组”和“产品类型”三个维度设置具体的返佣方案。

⚙ **关键配置逻辑**  
佣金计划通过以下组合维度进行差异化定价：
- **交易服务器 (Trading Server)**：选择对应的物理交易环境。
- **组名 (Group Name)**：指定交易平台对应的账户组。
- **产品类型 (Product Type)**：选择上一步定义的分类。

💵 **返佣参数设置**  
在对应的行项目中，管理员可以分别设置：
- **点差返佣 (Spread Rebate)**  
  按每手（per Lot）返还给代理的点差利润。  
  示例：在 MIM_S_B 组交易 stocks 类产品，设置点差返佣为 2 USD。

- **佣金返还 (Commission Rebate)**  
  按每手（per Lot）返还给代理的手续费。  
  示例：在 MIM_S_B 组交易 stocks 类产品，设置佣金返还为 3 USD。

⚠ **管理规则**  
- **上级差额设置**：可开启“上级代理获得点差/佣金差额”开关，系统将自动计算多级代理间的头寸差。
- **同级返佣限制**：可配置代理是否能从自己的交易中获得返佣（通常仅作为其上级的客户时产生返佣）。

## 📅 结算方案 (Settlement Plan)

结算方案用于定义代理佣金从“待结算”状态转入“可用余额”的时间周期与发放方式。系统支持灵活的自动化结算与人工审核机制。

### 1. 佣金结算逻辑
- **实时计算**  
  佣金在用户完成交易后，系统会立即根据预设的“佣金计划”进行计算。

- **待结算佣金 (Pending Commission)**  
  计算后的佣金将首先显示在代理面板的 Pending Commission 栏位中，此时资金尚未进入代理钱包。

- **正式结算**  
  当到达结算方案设定的时间点时，Pending Commission 会根据发放规则转入代理的钱包可用余额中。

### 2. 结算周期设置 (Settlement Cycle)

管理员可以根据业务需求，为不同的代理或账户组配置不同的结算周期：
- **实时 (Real-time)**  
  交易完成后立即完成结算并入账。

- **每日 (Daily)**  
  每天在指定时间点进行结算。  
  Example: Manual - Daily at 16:00

- **每周 (Weekly)**  
  每周固定某一天进行结算。  
  Example: Automatic - Every Thursday at 15:00

- **每月 (Monthly)**  
  每月固定日期进行结算。  
  Example: Automatic - Monthly on the 25th at 00:00

### 3. 发放方式 (Settlement Review)

系统提供两种主要的审核与发放模式，以确保资金安全：
- **自动发放 (Automatic)**  
  系统到达指定时间点后，自动执行结算操作，无需人工干预。

- **手动审核 (Manual Review)**  
  系统到达结算时间后会生成“结算审核单”。  
  管理员需进入后台进行审核，审核通过后佣金才会正式发放到代理钱包。

### 4. 核心配置项说明

在添加或编辑结算方案时，需填写以下关键信息：
- **结算方案名称 (Settlement Plan Name)**  
  用于区分不同的结算规则。  
  Example: Automatic - Monthly on the 25th at 00:00

- **结算日期与时间 (Settlement Date & Time)**  
  指定具体的结算触发时间，需注意系统时区的设置。

- **备注 (Remarks)**  
  用于记录该结算方案的特殊说明或内部审计编号。

## 👤 用户等级与方案管理 (User Level Management)

用户等级模块是系统的核心配置中心。通过为不同的等级关联统一的开户方案、佣金方案和结算方案，管理员可以高效地管理大量用户。同时，系统支持针对特定代理的个性化配置，以满足复杂的业务需求。

### 1. 用户等级配置 (User Level Setup)

管理员可以自定义多个用户等级（如 New Client, Platinum, IB, Super IB 等），并为每个等级预设一套标准的“方案包”。
- **开户方案 (Account Opening Plan)**  
  定义该等级用户在开户时遵循的规则（如杠杆、账户类型等）。

- **佣金方案 (Commission Plan)**  
  关联预设的产品分类返佣标准。

- **结算方案 (Settlement Plan)**  
  指定该等级代理佣金的发放周期与审核模式（自动或手动）。